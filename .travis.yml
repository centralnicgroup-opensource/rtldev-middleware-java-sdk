language: java
dist: xenial
notifications:
  email: false
sudo: false
install: true
jdk:
  - oraclejdk11
  - openjdk11
  - oraclejdk-ea
  - openjdk-ea
matrix:
  allow_failures:
    - jdk: openjdk-ea
    - jdk: oraclejdk-ea
cache:
  directories:
    - $HOME/.m2
    - $HOME/.cache/yarn
    - $HOME/.cache/pip
before_install:
  - if [[ "$TRAVIS_BRANCH" == "master" && "$TRAVIS_PULL_REQUEST" == "false" ]]; then
      openssl aes-256-cbc -K $encrypted_c9f9aedf26b7_key -iv $encrypted_c9f9aedf26b7_iv -in codesigning.asc.enc -out codesigning.asc -d &&
      gpg --import --batch codesigning.asc ; fi
script:
  - mvn site
  - mvn package
after_success:
  - if [[ "$TRAVIS_BRANCH" == "master" && "$TRAVIS_PULL_REQUEST" == "false" ]]; then
      git config --replace-all remote.origin.fetch +refs/heads/*:refs/remotes/origin/* &&
      git fetch --tags &&
      nvm install lts/* &&
      nvm use lts/* &&
      npm prune &&
      npm i &&
      npx travis-deploy-once "npx semantic-release" ; fi